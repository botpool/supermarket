{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="container">
    <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
    <div class="filters">
        <form method="get" action="{% url 'home' %}">
            <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" value="{{ search_query }}">
            <button type="submit" class="button">–ü–æ–∏—Å–∫</button>
            {% if search_query %}
            <a href="{% url 'home' %}" class="button">–°–±—Ä–æ—Å–∏—Ç—å</a>
            {% endif %}
        </form>
    </div>
    <div class="product-catalog">
        {% for category, products in categories %}
            <h3>{{ category.name }}</h3>
            <div class="product-list">
                {% for product in products %}
                    <div class="product-item">
                        <h4>{{ product.name }}</h4>
                        <p>{{ product.description }}</p>
                        <p>–¶–µ–Ω–∞: {{ product.price }} —Ä—É–±.</p>
                        <button class="add-to-cart-button" onclick="addToCart({{ product.id }})">üõí –í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

<script>
    function addToCart(productId) {
        fetch(`{% url 'add_to_cart' product_id=0 %}`.replace('0', productId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ quantity: 1 })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
            }
        });
    }
</script>
{% endblock %}
